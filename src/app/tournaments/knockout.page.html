<!-- Knockout Tournament Page Header -->
<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="ROUTES.TOURNAMENTS"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ CONSTANTS.LABELS.KNOCKOUT_TOURNAMENT }}</ion-title>
  </ion-toolbar>
</ion-header>

<!-- Main Content Area -->
<ion-content class="ion-padding">
  <!-- Tournament Information Card -->
  <ion-card [class]="CONSTANTS.CSS_CLASSES.TOURNAMENT_INFO_CARD">
    <ion-card-header [class]="CONSTANTS.CSS_CLASSES.TOURNAMENT_INFO_HEADER">
      <ion-card-title>{{ CONSTANTS.LABELS.TOURNAMENT_INFO }}</ion-card-title>
    </ion-card-header>
    <ion-card-content [class]="CONSTANTS.CSS_CLASSES.TOURNAMENT_INFO_CONTENT">
      <p><strong>{{ CONSTANTS.LABELS.STATUS }}:</strong> {{ getTournamentStatus() }}</p>
      <p>{{ CONSTANTS.LABELS.TEAMS }}: {{ teams.length }}</p>
      <p>{{ CONSTANTS.LABELS.TOTAL_MATCHES }}: {{ getTotalMatchesCount() }}</p>

      <!-- Action Buttons -->
      @if (canGenerateMatches()) {
        <ion-button 
          expand="block" 
          color="primary" 
          (click)="generateMatches()"
          [class]="CONSTANTS.CSS_CLASSES.GENERATE_BUTTON"
        >
          {{ CONSTANTS.LABELS.GENERATE_MATCHES }}
        </ion-button>
      }
      
      @if (canAdvanceToNextRound() && canEdit) {
        <ion-button 
          expand="block" 
          color="success" 
          (click)="advanceToNextRound()"
          [class]="CONSTANTS.CSS_CLASSES.ADVANCE_BUTTON"
        >
          <ion-icon [name]="CONSTANTS.ICONS.REFRESH" slot="start"></ion-icon>
          {{ getAdvanceButtonText() }}
        </ion-button>
      }
    </ion-card-content>
  </ion-card>

  <!-- Tournament Stages -->
  @for (stage of knockoutStages; track stage.name) {
    @if (hasStageMatches(stage)) {
      <ion-card [class]="CONSTANTS.CSS_CLASSES.STAGE_CARD">
        <ion-card-header [class]="CONSTANTS.CSS_CLASSES.STAGE_HEADER">
          <ion-card-title [class]="CONSTANTS.CSS_CLASSES.STAGE_TITLE">
            {{ stage.name }}
            <ion-chip
              [color]="getStageStatusColor(stage.matches)"
              [class]="CONSTANTS.CSS_CLASSES.STAGE_STATUS_CHIP"
            >
              {{ getStageStatus(stage.matches) }}
            </ion-chip>
          </ion-card-title>
        </ion-card-header>
        <!-- Stage Matches -->
        <ion-card-content [class]="CONSTANTS.CSS_CLASSES.STAGE_CONTENT">
          <ion-list [class]="CONSTANTS.CSS_CLASSES.MATCHES_LIST">
            @for (match of stage.matches; track match.id) {
              <ion-item 
                lines="full" 
                detail="true" 
                [routerLink]="getMatchControlRoute(match.id!)"
                [queryParams]="getMatchQueryParams()"
                [class]="CONSTANTS.CSS_CLASSES.MATCH_ITEM"
              >
                <ion-label [class]="CONSTANTS.CSS_CLASSES.MATCH_LABEL">
                  <!-- Match Title -->
                  <h2 [class]="CONSTANTS.CSS_CLASSES.MATCH_TITLE">
                    {{ getMatchTitle(match) }}
                  </h2>
                  
                  <!-- Match Status and Score -->
                  @if (isMatchFinished(match)) {
                    <ion-label [color]="CONSTANTS.COLORS.SUCCESS" [class]="CONSTANTS.CSS_CLASSES.MATCH_STATUS">
                      <h3 [class]="CONSTANTS.CSS_CLASSES.MATCH_SCORE">
                        {{ getFinalScoreText(match) }}
                      </h3>
                      <h3 [class]="CONSTANTS.CSS_CLASSES.MATCH_WINNER">
                        {{ getWinnerText(match) }}
                      </h3>
                    </ion-label>
                  } @else if (isMatchInProgress(match)) {
                    <ion-label [color]="CONSTANTS.COLORS.PRIMARY" [class]="CONSTANTS.CSS_CLASSES.MATCH_STATUS">
                      <h3>{{ getInProgressStatusText(match) }}</h3>
                    </ion-label>
                  } @else {
                    <ion-label [color]="CONSTANTS.COLORS.DANGER" [class]="CONSTANTS.CSS_CLASSES.MATCH_STATUS">
                      <h3>{{ getPendingStatusText() }}</h3>
                    </ion-label>
                  }
                </ion-label>
              </ion-item>
            }
          </ion-list>
        </ion-card-content>
      </ion-card>
    }
  }
</ion-content>
